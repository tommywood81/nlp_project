<!DOCTYPE html>
<html>
<head>
    <title>Analyse Your Own Text</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header class="page-header">
      <div class="container">
        <h1>Analyse Your Own Text</h1>
        <p class="subtitle">Paste your text and explore Sentiment, NER, Summarisation, Emotion, or QA.</p>
      </div>
    </header>

    <section class="container">
      <nav style="margin-bottom: 1rem; display:flex; gap:0.5rem; flex-wrap:wrap;">
        <a href="/?task=sentiment" class="button-secondary{% if task == 'sentiment' or not task %} active{% endif %}">Sentiment</a>
        <a href="/?task=ner" class="button-secondary{% if task == 'ner' %} active{% endif %}">NER</a>
        <a href="/?task=summarize" class="button-secondary{% if task == 'summarize' %} active{% endif %}">Summarise</a>
        <a href="/?task=emotion" class="button-secondary{% if task == 'emotion' %} active{% endif %}">Emotion</a>
        <a href="/?task=qa" class="button-secondary{% if task == 'qa' %} active{% endif %}">QA</a>
      </nav>

      <form id="nlp-form" action="/analyze/{{ task | default('sentiment') }}" method="post" class="analysis-form">
        <label>Choose an example</label>
        {% if task == "qa" %}
            {% for text in example_texts[:5] %}
            {% set parts = text.split('||') %}
            <div style="display:flex; align-items:center; gap:0.5rem;">
              <div style="flex:1;">
                <strong>Q:</strong> {{ parts[0] }}<br>
                <strong>Context:</strong> {{ parts[1] }}
              </div>
              <button type="button" class="button-primary" data-question="{{ parts[0]|e }}" data-context="{{ parts[1]|e }}">Use</button>
            </div>
            {% endfor %}
            <label>Or enter your own</label>
            <label>Question</label>
            <textarea name="text" id="user-text" rows="2" placeholder="Ask your question..."></textarea>
            <label>Context</label>
            <textarea name="context" id="user-context" rows="4" placeholder="Provide the context to search for the answer..."></textarea>
            <button type="submit" class="button-primary">Run</button>
        {% elif task == "summarize" %}
            {% for text in example_texts[:5] %}
            <div style="display:flex; align-items:flex-start; gap:0.5rem;">
              <div class="results" style="flex:1; margin:0;">
                {{ text }}
              </div>
              <button type="button" class="button-primary" data-summary="{{ text|e }}">Use</button>
            </div>
            {% endfor %}
            <label>Or enter your own text</label>
            <textarea name="text" id="user-text" rows="6" placeholder="Paste or type your text here..."></textarea>
            <button type="submit" class="button-primary">Run</button>
        {% else %}
            {% for text in example_texts[:10] %}
            <div style="display:flex; align-items:center; gap:0.5rem;">
              <select name="example" onchange="handleExampleChange(this)">
                <option value="{{ text }}">{{ text }}</option>
              </select>
              <button type="button" class="button-primary" onclick="submitExample(this)">Use</button>
            </div>
            {% endfor %}
            <label>Or enter your own text</label>
            <textarea name="text" id="user-text" rows="4" placeholder="Paste or type your text here..."></textarea>
            <button type="submit" class="button-primary">Run</button>
        {% endif %}
      </form>



      <div class="model-info-card">
        <h3>ü§ñ Model Information</h3>
        <div class="model-info-grid">
          <div class="model-info-item">
            <strong>Model:</strong>
            {% if task == "sentiment" %}
              TextBlob (PatternAnalyzer)
            {% elif task == "ner" %}
              spaCy en_core_web_sm
            {% elif task == "summarize" %}
              HuggingFace t5-small
            {% elif task == "emotion" %}
              bhadresh-savani/distilbert-base-uncased-emotion
            {% elif task == "qa" %}
              distilbert/distilbert-base-cased-distilled-squad
            {% endif %}
          </div>
          <div class="model-info-item">
            <strong>Accuracy:</strong>
            {% if task == "sentiment" %}
              ~60-70% on movie reviews
            {% elif task == "ner" %}
              ~85% F-score (CoNLL-2003)
            {% elif task == "summarize" %}
              ROUGE-2 F1 ~18-20 (CNN/DailyMail)
            {% elif task == "emotion" %}
              ~91% (GoEmotions dataset)
            {% elif task == "qa" %}
              EM: 79.1, F1: 86.9 (SQuAD v1.1)
            {% endif %}
          </div>
          <div class="model-info-item">
            <strong>Type:</strong>
            {% if task == "sentiment" %}
              Rule-based, lexicon-driven
            {% elif task == "ner" %}
              Transformer-based, pre-trained
            {% elif task == "summarize" %}
              Transformer-based, text-to-text
            {% elif task == "emotion" %}
              DistilBERT fine-tuned
            {% elif task == "qa" %}
              DistilBERT distilled from BERT
            {% endif %}
          </div>
          <div class="model-info-item">
            <strong>Use Case:</strong>
            {% if task == "sentiment" %}
              Prototyping, education, quick checks
            {% elif task == "ner" %}
              Named entity recognition, POS tagging
            {% elif task == "summarize" %}
              Text summarization, content condensation
            {% elif task == "emotion" %}
              Emotion detection, sentiment analysis
            {% elif task == "qa" %}
              Question answering, information extraction
            {% endif %}
          </div>
        </div>
      </div>

      {% set blurbs = {
        'sentiment': 'Reveals tone and objectivity; polarity in [-1,1], subjectivity in [0,1].',
        'ner': 'Finds entities like people, places, and organisations using token classification.',
        'summarize': 'Condenses long text into concise, readable summaries.',
        'emotion': 'Classifies nuanced emotions with per-class scores.',
        'qa': 'Extracts the most relevant answer span from the provided context.'
      } %}
      <div class="explanation-card" style="border-left-color:#10B981; background:#ECFDF5;">
        <h2>What's Happening</h2>
        <p>{{ blurbs.get(task, '') }}</p>
      </div>

      <div class="nav-buttons">
        <a href="/home" class="button-home">üè† Home</a>
        <a href="/news/browse" class="button-secondary">Analyse ABC News</a>
      </div>
    </section>

    <script>
    function handleExampleChange(select) {
      // No-op: handled on button click
    }
    function submitExample(btn) {
      var form = document.getElementById('nlp-form');
      var select = btn.parentElement.querySelector('select');
      var value = select.value;
      var task = "{{ task }}";
      if (task !== "qa") {
        document.getElementById('user-text').value = value;
      }
      form.submit();
    }
    // QA buttons
    document.querySelectorAll('button[data-question]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        document.getElementById('user-text').value = btn.getAttribute('data-question');
        document.getElementById('user-context').value = btn.getAttribute('data-context');
        document.getElementById('nlp-form').submit();
      });
    });
    // Summarise buttons
    document.querySelectorAll('button[data-summary]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        document.getElementById('user-text').value = btn.getAttribute('data-summary');
        document.getElementById('nlp-form').submit();
      });
    });
    </script>
</body>
</html>