<!DOCTYPE html>
<html>
<head>
    <title>Analyse Your Own Text</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header class="page-header">
      <div class="container">
        <h1>Analyse Your Own Text</h1>
        <p class="subtitle">Paste your text and explore Sentiment, NER, Summarisation, Emotion, or QA.</p>
      </div>
    </header>

    <section class="container">
      <nav style="margin-bottom: 1rem; display:flex; gap:0.5rem; flex-wrap:wrap;">
        <a href="/?task=sentiment" class="button-secondary{% if task == 'sentiment' %} active{% endif %}">Sentiment</a>
        <a href="/?task=ner" class="button-secondary{% if task == 'ner' %} active{% endif %}">NER</a>
        <a href="/?task=summarize" class="button-secondary{% if task == 'summarize' %} active{% endif %}">Summarise</a>
        <a href="/?task=emotion" class="button-secondary{% if task == 'emotion' %} active{% endif %}">Emotion</a>
        <a href="/?task=qa" class="button-secondary{% if task == 'qa' %} active{% endif %}">QA</a>
      </nav>

      <form id="nlp-form" action="/analyze/{{ task | default('sentiment') }}" method="post" class="analysis-form">
        <label>Choose an example</label>
        {% if task == "qa" %}
            {% for text in example_texts[:5] %}
            {% set parts = text.split('||') %}
            <div style="display:flex; align-items:center; gap:0.5rem;">
              <div style="flex:1;">
                <strong>Q:</strong> {{ parts[0] }}<br>
                <strong>Context:</strong> {{ parts[1] }}
              </div>
              <button type="button" class="button-primary" data-question="{{ parts[0]|e }}" data-context="{{ parts[1]|e }}">Use</button>
            </div>
            {% endfor %}
            <label>Or enter your own</label>
            <label>Question</label>
            <textarea name="text" id="user-text" rows="2" placeholder="Ask your question..."></textarea>
            <label>Context</label>
            <textarea name="context" id="user-context" rows="4" placeholder="Provide the context to search for the answer..."></textarea>
            <button type="submit" class="button-primary">Run</button>
        {% elif task == "summarize" %}
            {% for text in example_texts[:5] %}
            <div style="display:flex; align-items:flex-start; gap:0.5rem;">
              <div class="results" style="flex:1; margin:0;">
                {{ text }}
              </div>
              <button type="button" class="button-primary" data-summary="{{ text|e }}">Use</button>
            </div>
            {% endfor %}
            <label>Or enter your own text</label>
            <textarea name="text" id="user-text" rows="6" placeholder="Paste or type your text here..."></textarea>
            <button type="submit" class="button-primary">Run</button>
        {% else %}
            {% for text in example_texts[:10] %}
            <div style="display:flex; align-items:center; gap:0.5rem;">
              <select name="example" onchange="handleExampleChange(this)">
                <option value="{{ text }}">{{ text }}</option>
              </select>
              <button type="button" class="button-primary" onclick="submitExample(this)">Use</button>
            </div>
            {% endfor %}
            <label>Or enter your own text</label>
            <textarea name="text" id="user-text" rows="4" placeholder="Paste or type your text here..."></textarea>
            <button type="submit" class="button-primary">Run</button>
        {% endif %}
      </form>

      {% set model_infos = {
        'sentiment': {
          'title': 'Sentiment (TextBlob)',
          'model': 'TextBlob (PatternAnalyzer)',
          'accuracy': '~60-70% on movie reviews (not SOTA, but fast and simple)',
          'used_by': 'Prototyping, education, quick sentiment checks',
          'description': 'Rule-based, lexicon-driven sentiment analysis.'
        },
        'ner': {
          'title': 'NER (spaCy en_core_web_sm)',
          'model': 'spaCy en_core_web_sm',
          'accuracy': '~85% F-score (CoNLL-2003 NER)',
          'used_by': 'Explosion AI, research, industry demos',
          'description': 'Lightweight English NER, POS, and dependency parser.'
        },
        'summarize': {
          'title': 'Summarise (t5-small)',
          'model': 'HuggingFace t5-small',
          'accuracy': 'ROUGE-2 F1 ~18-20 (CNN/DailyMail)',
          'used_by': 'Research, demos, low-resource summarisation',
          'description': 'Transformer-based, pre-trained for text-to-text tasks.'
        },
        'emotion': {
          'title': 'Emotion (distilbert-base-uncased-emotion)',
          'model': 'bhadresh-savani/distilbert-base-uncased-emotion',
          'accuracy': '~91% (GoEmotions dataset)',
          'used_by': 'Emotion detection demos, chatbots',
          'description': 'DistilBERT fine-tuned for emotion classification.'
        },
        'qa': {
          'title': 'QA (distilbert-base-cased-distilled-squad)',
          'model': 'distilbert/distilbert-base-cased-distilled-squad',
          'accuracy': 'EM: 79.1, F1: 86.9 (SQuAD v1.1)',
          'used_by': 'Lightweight QA demos, education',
          'description': 'DistilBERT distilled from BERT, fine-tuned on SQuAD.'
        }
      } %}

      <div class="explanation-card">
        <h2>Model Information</h2>
        {% set info = model_infos.get(task, {}) %}
        <p>
          <strong>{{ info.title }}</strong><br>
          <b>Model:</b> {{ info.model }}<br>
          <b>Accuracy:</b> {{ info.accuracy }}<br>
          <b>Used by:</b> {{ info.used_by }}<br>
          <b>Description:</b> {{ info.description }}
        </p>
      </div>

      {% set blurbs = {
        'sentiment': 'Reveals tone and objectivity; polarity in [-1,1], subjectivity in [0,1].',
        'ner': 'Finds entities like people, places, and organisations using token classification.',
        'summarize': 'Condenses long text into concise, readable summaries.',
        'emotion': 'Classifies nuanced emotions with per-class scores.',
        'qa': 'Extracts the most relevant answer span from the provided context.'
      } %}
      <div class="explanation-card" style="border-left-color:#10B981; background:#ECFDF5;">
        <h2>Whatâ€™s Happening</h2>
        <p>{{ blurbs.get(task, '') }}</p>
      </div>
    </section>

    <script>
    function handleExampleChange(select) {
      // No-op: handled on button click
    }
    function submitExample(btn) {
      var form = document.getElementById('nlp-form');
      var select = btn.parentElement.querySelector('select');
      var value = select.value;
      var task = "{{ task }}";
      if (task !== "qa") {
        document.getElementById('user-text').value = value;
      }
      form.submit();
    }
    // QA buttons
    document.querySelectorAll('button[data-question]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        document.getElementById('user-text').value = btn.getAttribute('data-question');
        document.getElementById('user-context').value = btn.getAttribute('data-context');
        document.getElementById('nlp-form').submit();
      });
    });
    // Summarise buttons
    document.querySelectorAll('button[data-summary]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        document.getElementById('user-text').value = btn.getAttribute('data-summary');
        document.getElementById('nlp-form').submit();
      });
    });
    </script>
</body>
</html>